#!/bin/bash
image="praqma/tis"
START=""

checkArgs()
{
if [ "$1" == "all" ]; then
START="\
start-jira.sh \
start-confluence.sh \
start-bitbucket.sh \
start-bamboo.sh \
start.sh"
fi

if [ "$1" == "ji" ];then
START=${START}"start-jira.sh "
fi
if [ "$1" == "co" ];then
START=${START}"start-confluence.sh "
fi
if [ "$1" == "bb" ];then
START=${START}"start-bitbucket.sh "
fi
if [ "$1" == "ba" ];then
START=${START}"start-bamboo.sh "
fi
if [ "$1" == "fc" ];then
START=${START}"start.sh "
fi
}

fixHostEntries(){
cat << EOF >> ~/.ssh/hosts
127.0.0.1 crowd.teamsinspace.com
127.0.0.1 bitbucket.teamsinspace.com
127.0.0.1 bamboo.teamsinspace.com
127.0.0.1 fecru.teamsinspace.com
127.0.0.1 confluence.teamsinspace.com
127.0.0.1 jira.teamsinspace.com
EOF
}

if [ "$1" == "host" ];then
fixHostEntries

elif [ "$1" == "kill" ];then
docker rm -f tim_in_space
elif [ "$1" == "start" ];then
if [ ! "$2" ]; then 
exit 1
fi
for i in "${@:2}"
do
checkArgs $i
done

docker run --name tim_in_space -dit -p 2430:2430 -p 7990:7990 -p 8060:8060 -p 8080:8080 -p 8085:8085 -p 8090:8090 $image $START
# jira  # 8080
# start-confluence.sh \ # 8090
# start-bitbucket.sh \ # 7990
# start-bamboo.sh \ # 8085
# start.sh" # FECRU 8060
else
echo "timinspace hosts if you want to add the entries to your /etc/host file"
echo "To start enter run and the name of the services"
echo "ex timinspace start ji co bb ba fc"
echo "ji => jira on port 8080"
echo "co => confluence on port 8090"
echo "bb => bitbacket on port 7990"
echo "ba => bamboo on port 8085"
echo "fc => fisheye crucible on port 80 60"
echo "to destroy the box run timinspace kill"
fi